<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Climate Planner</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <img src="{{ url_for('static', filename='img/logo.jpg') }}" alt="Logo" onerror="this.style.display='none'">
        </div>
        <div class="loading-text">MR NASA</div>
        <div class="loading-spinner"></div>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>

    <!-- Fixed World Background -->
    <div class="world-background">
        <img src="{{ url_for('static', filename='img/world.png') }}" alt="World Map" class="world-image" onerror="this.style.display='none'">
    </div>

    <div class="planner-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-circle">
                    <img src="{{ url_for('static', filename='img/logo.jpg') }}" alt="Logo" onerror="this.style.display='none'">
                </div>
                <h1>Urban Climate Planner</h1>
            </div>
            <div class="user-info">
                <span class="username">{{ user }} ({{ session.role }})</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Time Range Section -->
            <div class="sidebar-section">
                <h3 class="section-title">Time Range</h3>
                <div class="date-picker">
                    <div class="date-input-group">
                        <label>Start Date</label>
                        <input type="date" id="start-date" class="date-input">
                    </div>
                    <div class="date-input-group">
                        <label>End Date</label>
                        <input type="date" id="end-date" class="date-input">
                    </div>
                    <small class="hint-text">Leave empty for last 30 days</small>
                </div>
            </div>

            <!-- Map Layers Section -->
            <div class="sidebar-section">
                <h3 class="section-title">Map Layers</h3>
                <div class="layer-item">
                    <input type="checkbox" id="layer-modis" checked>
                    <label for="layer-modis">Temperature (MODIS LST)</label>
                </div>
                <div class="layer-item">
                    <input type="checkbox" id="layer-viirs">
                    <label for="layer-viirs">Night Lights (VIIRS)</label>
                </div>
                <div class="layer-item">
                    <input type="checkbox" id="layer-ndvi">
                    <label for="layer-ndvi">Vegetation (NDVI)</label>
                </div>
                <div class="layer-item">
                    <input type="checkbox" id="layer-heatmap">
                    <label for="layer-heatmap">Suitability Heatmap</label>
                </div>
            </div>

            <!-- Place Structure Section -->
            <div class="sidebar-section">
                <h3 class="section-title">Place Structure</h3>
                <select id="structure-type" class="structure-select">
                    <option value="house">House</option>
                    <option value="hospital">Hospital</option>
                    <option value="school">School</option>
                    <option value="park">Park</option>
                    <option value="water">Water Treatment Plant</option>
                </select>
                <button class="action-btn" id="place-structure">Click to Place Structure</button>
                <p class="hint-text">
                    Select a structure type, click the button, then click on the map to place it.
                </p>
            </div>

            <!-- Analysis Section -->
            <div class="sidebar-section">
                <h3 class="section-title">Analysis</h3>
                <button class="action-btn" id="score-selected">Analyze Selected Points</button>
                <button class="action-btn secondary" id="clear-markers-btn">Clear All Points</button>
                
                <div class="loading-indicator" id="loading">
                    <div class="spinner"></div>
                    <p>Analyzing locations...</p>
                </div>

                <div id="recommendations"></div>
            </div>
        </aside>

        <!-- Map Container -->
        <div id="map"></div>
    </div>

    <!-- Modal for Detailed Analysis -->
    <div id="rec-modal" class="modal">
        <div class="modal-content">
            <span id="rec-close" class="close">&times;</span>
            <div id="rec-body"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
</body>
</html>